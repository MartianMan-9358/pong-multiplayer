<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pong â€” Firebase Multiplayer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { background:#111; color:#fff; text-align:center; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial; }
    canvas { display:block; margin:18px auto; background:#000; border:1px solid #333; }
    #diag { position:fixed; right:12px; top:12px; background:#222; color:#fff; padding:8px 10px;
            font-family:monospace; font-size:13px; z-index:9999; border-radius:6px; max-width:420px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h1>Pong</h1>
  <p>Player 1: W/S â€” Player 2: â†‘/â†“</p>
  <canvas id="game" width="800" height="500"></canvas>
  <div id="diag">bootingâ€¦</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    // ðŸ”‘ Your Firebase config (replace with your actual values)
    const firebaseConfig = {
      apiKey: "AIzaSyBgkAWSnDv3ytWCGXlxhrl_38k6zLRqNWs",
      authDomain: "pongvanilla.firebaseapp.com",
      databaseURL: "https://pongvanilla.firebaseio.com",
      projectId: "pongvanilla",
      storageBucket: "pongvanilla.appspot.com",
      messagingSenderId: "146180407280",
      appId: "1:146180407280:web:e9791c16f3914adcb0e735"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const diagEl = document.getElementById('diag');
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const PADDLE_H = 100, PADDLE_W = 12, BALL_R = 8;

    const state = {
      ball: { x: W/2, y: H/2, vx: 4, vy: 3 },
      paddles: { p1: { y: (H-PADDLE_H)/2 }, p2: { y: (H-PADDLE_H)/2 } },
      scores: { p1: 0, p2: 0 },
      slot: null,
      hosting: false
    };

    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup',   e => keys[e.code] = false);

    function draw() {
      ctx.fillStyle = '#000'; ctx.fillRect(0,0,W,H);
      ctx.strokeStyle = '#333'; ctx.setLineDash([8,12]); ctx.beginPath(); ctx.moveTo(W/2,0); ctx.lineTo(W/2,H); ctx.stroke(); ctx.setLineDash([]);
      ctx.fillStyle = '#fff';
      ctx.fillRect(20, state.paddles.p1.y, PADDLE_W, PADDLE_H);
      ctx.fillRect(W - 20 - PADDLE_W, state.paddles.p2.y, PADDLE_W, PADDLE_H);
      ctx.beginPath(); ctx.arc(state.ball.x, state.ball.y, BALL_R, 0, Math.PI*2); ctx.fill();
      ctx.font = '20px monospace';
      ctx.fillText(state.scores.p1, W*0.25, 30);
      ctx.fillText(state.scores.p2, W*0.75, 30);
    }

    function applyLocalInput() {
      const clamp = y => Math.max(0, Math.min(H - PADDLE_H, y));
      if (state.slot === 'p1') {
        if (keys['KeyW']) state.paddles.p1.y -= 6;
        if (keys['KeyS']) state.paddles.p1.y += 6;
        state.paddles.p1.y = clamp(state.paddles.p1.y);
        set(ref(db, "paddles/p1"), { y: state.paddles.p1.y });
      }
      if (state.slot === 'p2') {
        if (keys['ArrowUp']) state.paddles.p2.y -= 6;
        if (keys['ArrowDown']) state.paddles.p2.y += 6;
        state.paddles.p2.y = clamp(state.paddles.p2.y);
        set(ref(db, "paddles/p2"), { y: state.paddles.p2.y });
      }
    }

    // Host updates ball + scores
    function startHost() {
      setInterval(() => {
        const b = state.ball;
        b.x += b.vx; b.y += b.vy;
        if (b.y < BALL_R || b.y > H - BALL_R) b.vy *= -1;
        const p1X = 20 + PADDLE_W, p2X = W - 20 - PADDLE_W;
        const hitP1 = (b.x - BALL_R < p1X && b.y > state.paddles.p1.y && b.y < state.paddles.p1.y + PADDLE_H);
        const hitP2 = (b.x + BALL_R > p2X && b.y > state.paddles.p2.y && b.y < state.paddles.p2.y + PADDLE_H);
        if (hitP1) b.vx = Math.abs(b.vx);
        if (hitP2) b.vx = -Math.abs(b.vx);
        if (b.x < 0) { state.scores.p2++; Object.assign(b, { x: W/2, y: H/2, vx: 4, vy: 3 }); }
        if (b.x > W) { state.scores.p1++; Object.assign(b, { x: W/2, y: H/2, vx: -4, vy: -3 }); }

        set(ref(db, "ball"), b);
        set(ref(db, "scores"), state.scores);
      }, 1000/60);
    }

    // Firebase listeners
    onValue(ref(db, "paddles/p1"), snap => { const val = snap.val(); if (val) state.paddles.p1.y = val.y; });
    onValue(ref(db, "paddles/p2"), snap => { const val = snap.val(); if (val) state.paddles.p2.y = val.y; });
    onValue(ref(db, "ball"), snap => { const val = snap.val(); if (val) state.ball = val; });
    onValue(ref(db, "scores"), snap => { const val = snap.val(); if (val) state.scores = val; });

    // Assign slot manually (for demo: first browser = p1, second = p2)
    state.slot = prompt("Enter slot: p1 or p2");

    // Decide host manually (for demo: first browser acts as host)
    if (state.slot === 'p1') startHost();

    function loop() {
      applyLocalInput();
      draw();
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
